<div class="perfil-container">
  <h1 class="perfil-title">Mi Perfil - Administrador</h1>

  <!-- Mensaje de error -->
  <div class="error-container" *ngIf="error">
    <i class="fas fa-exclamation-circle"></i>
    <p>{{ error }}</p>
    <button class="btn-retry" (click)="cargarPerfil()">
      <i class="fas fa-sync-alt"></i> Reintentar
    </button>
  </div>

  <!-- Loading -->
  <div class="loading-container" *ngIf="loading">
    <div class="spinner"></div>
    <p>Cargando perfil...</p>
  </div>

  <!-- Contenido del perfil -->
  <div class="perfil-content" *ngIf="!loading && !error && perfil">
    <!-- Información personal -->
    <div class="info-section">
      <h2>
        <i class="fas fa-user-shield"></i>
        Información Personal
      </h2>
      <div class="info-grid">
        <div class="info-item">
          <label>Nombre de usuario:</label>
          <span>{{ perfil.NombreUsuario }}</span>
        </div>
        <div class="info-item">
          <label>Correo electrónico:</label>
          <span>{{ perfil.CorreoElectronico }}</span>
        </div>
        <div class="info-item">
          <label>Teléfono:</label>
          <span>{{ perfil.TelefonoCelular || 'No registrado' }}</span>
        </div>
        <div class="info-item">
          <label>Rol:</label>
          <span class="rol-badge">{{ perfil.Rol }}</span>
        </div>
        <div class="info-item">
          <label>Fecha de registro:</label>
          <span>{{ formatearFecha(perfil.FechaCreacion) }}</span>
        </div>
        <div class="info-item">
          <label>Último acceso:</label>
          <span>{{ formatearFecha(perfil.FechaUltimoAcceso) }}</span>
        </div>
      </div>
    </div>

    <!-- Estadísticas globales del sistema -->
    <div class="estadisticas-section" *ngIf="estadisticas">
      <h2>
        <i class="fas fa-chart-bar"></i>
        Estadísticas del Sistema
      </h2>

      <div class="stats-grid">
        <!-- Total de historias -->
        <div class="stat-card">
          <div class="stat-icon total">
            <i class="fas fa-file-medical"></i>
          </div>
          <div class="stat-info">
            <h3>{{ estadisticas.total }}</h3>
            <p>Historias clínicas activas</p>
          </div>
        </div>

        <!-- Total de alumnos -->
        <div class="stat-card">
          <div class="stat-icon alumnos">
            <i class="fas fa-user-graduate"></i>
          </div>
          <div class="stat-info">
            <h3>{{ estadisticas.totalAlumnos }}</h3>
            <p>Alumnos activos</p>
          </div>
        </div>

        <!-- Total de profesores -->
        <div class="stat-card">
          <div class="stat-icon profesores">
            <i class="fas fa-chalkboard-teacher"></i>
          </div>
          <div class="stat-info">
            <h3>{{ estadisticas.totalProfesores }}</h3>
            <p>Profesores activos</p>
          </div>
        </div>

        <!-- Total de materias -->
        <div class="stat-card">
          <div class="stat-icon materias">
            <i class="fas fa-book"></i>
          </div>
          <div class="stat-info">
            <h3>{{ estadisticas.totalMaterias }}</h3>
            <p>Materias activas</p>
          </div>
        </div>

        <!-- Historias archivadas -->
        <div class="stat-card" *ngIf="estadisticas.archivadas > 0">
          <div class="stat-icon archivadas">
            <i class="fas fa-archive"></i>
          </div>
          <div class="stat-info">
            <h3>{{ estadisticas.archivadas }}</h3>
            <p>Historias archivadas</p>
          </div>
        </div>

        <!-- Estados -->
        <div class="stat-card" *ngFor="let estado of obtenerEstadosConValores()">
          <div class="stat-icon" [ngClass]="estado.estado.toLowerCase().replace(' ', '-')">
            <i class="fas"
               [ngClass]="{
                 'fa-plus-circle': estado.estado === 'Nuevo',
                 'fa-check-circle': estado.estado === 'Corregido',
                 'fa-spinner': estado.estado === 'En proceso',
                 'fa-eye': estado.estado === 'Revisión',
                 'fa-edit': estado.estado === 'Corrección',
                 'fa-flag-checkered': estado.estado === 'Finalizado'
               }"></i>
          </div>
          <div class="stat-info">
            <h3>{{ estado.cantidad }}</h3>
            <p>{{ estado.estado }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Acciones -->
    <div class="acciones-section">
      <h2>
        <i class="fas fa-cog"></i>
        Acciones
      </h2>
      <div class="acciones-buttons">
        <button class="btn-accion volver" routerLink="/admin/dashboard">
          <i class="fas fa-arrow-left"></i>
          Volver al Dashboard
        </button>
        <button class="btn-accion cerrar-sesion" (click)="cerrarSesion()">
          <i class="fas fa-sign-out-alt"></i>
          Cerrar Sesión
        </button>
      </div>
    </div>
  </div>
</div>